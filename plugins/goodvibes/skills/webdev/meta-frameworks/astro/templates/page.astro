---
// Astro Page Template
// Location: src/pages/[page-name].astro

import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Types
interface Props {
  title: string;
}

// Page metadata
const title = 'Page Title';
const description = 'Page description for SEO';

// Fetch data at build time
const posts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

const sortedPosts = posts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 5);

// Dynamic data from URL (for dynamic routes)
// const { slug } = Astro.params;
// const { searchParams } = Astro.url;
// const query = searchParams.get('q');
---

<BaseLayout title={title} description={description}>
  <main class="container">
    <section class="hero">
      <h1>{title}</h1>
      <p class="lead">{description}</p>
    </section>

    <section class="content">
      <h2>Latest Posts</h2>

      {sortedPosts.length === 0 ? (
        <p class="empty">No posts yet.</p>
      ) : (
        <ul class="post-list">
          {sortedPosts.map((post) => (
            <li class="post-item">
              <article>
                <a href={`/blog/${post.slug}`}>
                  <h3>{post.data.title}</h3>
                </a>
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                  })}
                </time>
                <p>{post.data.description}</p>
                {post.data.tags.length > 0 && (
                  <ul class="tags">
                    {post.data.tags.map((tag) => (
                      <li>
                        <a href={`/tags/${tag}`}>{tag}</a>
                      </li>
                    ))}
                  </ul>
                )}
              </article>
            </li>
          ))}
        </ul>
      )}

      <a href="/blog" class="view-all">View all posts &rarr;</a>
    </section>
  </main>
</BaseLayout>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .hero {
    text-align: center;
    margin-bottom: 3rem;
  }

  .hero h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  .lead {
    font-size: 1.25rem;
    color: #666;
  }

  .post-list {
    list-style: none;
    padding: 0;
    display: grid;
    gap: 1.5rem;
  }

  .post-item {
    padding: 1.5rem;
    border: 1px solid #eee;
    border-radius: 8px;
    transition: box-shadow 0.2s;
  }

  .post-item:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .post-item h3 {
    margin: 0 0 0.5rem;
  }

  .post-item a {
    color: inherit;
    text-decoration: none;
  }

  .post-item a:hover {
    color: #0066cc;
  }

  .post-item time {
    font-size: 0.875rem;
    color: #666;
  }

  .post-item p {
    margin: 0.5rem 0;
    color: #444;
  }

  .tags {
    display: flex;
    gap: 0.5rem;
    list-style: none;
    padding: 0;
    margin: 0.5rem 0 0;
  }

  .tags li a {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background: #f0f0f0;
    border-radius: 4px;
  }

  .empty {
    text-align: center;
    color: #666;
    padding: 2rem;
  }

  .view-all {
    display: inline-block;
    margin-top: 1.5rem;
    color: #0066cc;
  }
</style>
